---
title: 对称加密、非对称加密、摘要、数字签名、数字证书
tags:
  - http
copyright: true
comments: true
date: 2020-07-09 09:51:49
categories: 知识
top: 107
photos:
---

作为一个开发人员，或多或少都听说过对称加密、非对称加密、摘要、数字签名、数字证书这几个概念，它们是用来保证在互联网通信过程中数据传输安全的。有人可能会有疑惑，我给传输数
据加个密不就安全了，为什么还要搞这么多花样出来？本文主要通过一个案例来讲解这几个概念的实际作用。

在此之前，我先简单介绍一下这几个概念。

## 对称加密

对称加密是指用来加密和解密的是同一个秘钥。其特点是加密速度快，但是秘钥容易被黑客截获，所以安全性不高。密钥不可能一开始在发送方和接收方都全部生成好了 需要在一方生成之后传递给另一方 如果在传递过程密钥被劫持 整个加密就不安全了。常见的有 AES、DES 算法。

## 非对称加密

非对称加密是指用来加密和解密的是不同的秘钥，它们是成对出现的，称为公钥和私钥，知道其中一个秘钥是无法推导出另外一个秘钥的。用公钥加密的内容需要用私钥才能解密，用私钥加密
的内容需要用公钥才能解密。非对称加密的特点是安全性高，缺点是加密速度慢。公钥对外公开 如果密文是私钥加密 那么任何人都能用公钥解密。常见的有 RSA、ECC 算法。

## 混合加密

在传递过程把我们的对称加密中的密钥用非对称加密的方式去传递就好了。
![mix](http://cdn.mydearest.cn/blog/images/mix.png)

## 摘要

所谓的摘要就是一段信息或者一个文件通过某个哈希算法(也叫摘要算法)而得到的一串字符。摘要算法的特点就是不同的文件计算出的摘要是不同的(也有可能相同，但是可能性非常非常低)，
比如一个 1G 的视频文件，哪怕只是改动其中一个字节，最后计算得到的摘要也是完全不同的，所以摘要算法通常是用来判断文件是否被篡改过。其还有一个特点就是通过摘要是无法推导出源文
件的信息的。常用的摘要(散列)算法有 MD5、SHA 等。

## 数字签名

数字签名就是一个文件的摘要加密后的信息。数字签名是和源文件一起发送给接收方的，接收方收到后对文件用摘要算法算出一个摘要，然后和数字签名中的摘要进行比对，两者不一致的话说
明文件被篡改了。

## 数字证书

数字证书是一个经证书授权中心生成的文件，数字证书里一般会包含公钥、公钥拥有者名称、CA 的数字签名、有效期、授权中心名称、证书序列号等信息。其中 CA 的数字签名是验证证书是否被
篡改的关键，它其实就是对证书里面除了 CA 的数字签名以外的内容进行摘要算法得到一个摘要，然后 CA 机构用他自己的私钥对这个摘要进行加密就生成了 CA 的数字签名，CA 机构会公开它的公
钥，验证证书时就是用这个公钥解密 CA 的数字签名，然后用来验证证书是否被篡改。

---

<!--more-->

## 案例讲解

场景：
张三要找人装修一个房子，原则是谁的出价便宜就给谁装修，所以对于报价文件就是属于机密文件。下面我们来看下不同的方式传输报价文件都会有什么风险。

### 通过对称加密有什么风险

现在李四想接这个装修的活，他做了一份报价文件(文件名:lisi.txt，文件内容:报价 50 万)。然后李四用一个对称秘钥 123 对这个文件进行加密。最后李四将这个秘钥和加密的文件发给张三，
张三收到后用这个秘钥解密，知道了李四的报价是 50 万。同时王五也想接这个装修的活，他本来是想报价 55 万的，但是又担心报价太高而丢掉这个活。恰巧王五是个黑客高手，于是他截获了李
四发给张三的秘钥和加密文件，知道了李四报价是 50 万。最后王五将自己的报价改成了 49 万发给张三，结果王五接下了这个装修活。

> 结论：用对称加密的话，一旦秘钥被黑客截获，加密就形同虚设，所以安全性比较低。

### 如果用非对称加密会怎么样

首先张三会生成一对秘钥，私钥是 zhangsan1，公钥是 zhangsan2，私钥张三自己保存，将公钥公布出去。

李四将报价文件 list.txt 用张三公布的公钥 zhangsan2 进行加密后传给张三，然后张三用私钥 zhangsan1 进行解密得到李四的报价是 50 万。

这个时候即使王五截获到了李四发给张三的报价文件，由于王五没有张三的私钥，所以他是无法解密文件的，也就无法知道李四的报价。最后王五因为报价 55 万而丢掉了这个装修的机会。

所以用非对称加密是可以保证数据传输安全的。不过这里说一句题外话，既然非对称加密安全性高，那为什么不淘汰掉对称加密呢？其实关键就在于加密速度，非对称加密计算量很大，所以加
密速度是很慢的，如果发送消息非常频繁，使用非对称加密的话就会对性能造成很大影响。所以在实际开发过程中通常是对称加密和非对称加密结合使用的。也就是对称加密的秘钥是用非对称
加密后发送的，这样能保证对称加密的秘钥不被黑客截获，然后在发送业务数据时就用对称加密。这样既保证了安全性也保证了加密速度。

> 结论：非对称加密可以防止黑客截获加密后的内容，安全性高。

### 数字签名有什么用

前面都说了非对称加密是安全的，那为什么还要数字签名呢？

设想一下，王五截获了李四的报价文件，王五虽然无法知道李四的实际报价，但是他完全可以伪造一份李四的报价(文件名:lisi.txt，文件内容:报价 60 万)，然后将这份伪造文件用张三公布
的公钥 zhangsan2 进行加密后替换原来的报价文件。张三收到后解密发现报价是 60 万，于是张三就以为李四报的价是 60 万，最后决定将装修的活给报价 55 万的王五来做。

发生这个问题的关键就在于张三无法知道报价文件是否被篡改过。要解决这个问题就需要用到数字签名。首先李四需要自己生成一对非对称加密的秘钥，私钥 lisi1 自己保存，公钥 lisi2 发给张
三。然后李四对自己的报价文件通过摘要算法得到一个摘要(假设摘要是 aaa)，再用自己的私钥 lisi1 加密这个摘要就得到了报价文件的数字签名，最后将加密的报价文件和数字签名一起发给张
三，张三收到后先用李四发过来的公钥 lisi2 解密数字签名得到摘要 aaa，然后用自己的私钥 zhangsan1 解密加密的文件得到报价源文件，然后对报价源文件进行摘要算法，看计算得到的结果是
不是 aaa，如果不是 aaa 的话就说明报价文件被篡改了。

在这种情况下，如果王五截获了李四发给张三的文件。王五是无法解密报价文件的。如果王五伪造一份报价文件的话，等张三收到后就会发现报价文件和数字签名不匹配。那王五能不能伪造报
价文件的同时也伪造签名呢？因为王五没有李四的私钥，所以没法对伪造的报价文件的摘要进行加密，所以也就没法伪造签名。

> 结论：非对称加密虽然能确保加密文件内容不被窃取，但不能保证文件不被篡改。数字签名就是用来验证文件是否被篡改过。

### 数字证书有什么用

既然非对称加密可以保证文件内容的安全性，数字签名又可以保证文件不被篡改，那还要数字证书有什么用呢？

我们再来设想一下，王五自己也生成了一对用于非对称加密的秘钥，私钥是 wangwu1，公钥是 wangwu2。前面李四将自己的公钥 lisi2 发给张三的过程中被王五给截获了，王五用自己的公钥
wangwu2 替换了李四的公钥 lisi2，所以张三最后收到的公钥实际上是王五的，但张三对这并不知情。后面李四发的数字签名和加密的报价文件都被王五截获，并且王五伪造了一份报价文件，同
时用自己的私钥加密报价文件的摘要生成伪造的签名并发给张三，张三收到后进行验证发现数字签名和报价文件是匹配的，就以为这份报价文件是真实的。

出现这个问题的关键就在于张三没法确认收到的公钥到底是不是李四发的，这个时候数字证书就起到作用了。李四到权威的数字证书机构申请数字证书，证书里面包含了公钥(lisi2)和公钥的
拥有者(李四)等相关信息，然后李四将证书发给张三，张三通过证书里面的信息就可以知道公钥到底是不是李四的了。

那证书在发送过程中有没有可能被王五截获并篡改呢？要知道证书里面还包含 CA 的数字签名，这个签名是证书机构用他们自己的私钥对证书的摘要进行加密的，而公钥是公开的。所以即便王五
截获并篡改了证书内容，他也无法伪造证书机构的签名，张三在收到证书后通过验证签名也会发现证书被篡改了。
