makeInstaller=function(n){"use strict";var e=(n=n||{}).extensions||[".js",".json"],t=n.onInstall,r=n.wrapRequire,f=n.override,o=n.fallback,l=n.mainFields||(n.browser?["browser","main"]:["main"]),i={}.hasOwnProperty;function u(n,e){return y(n)&&w(e)&&i.call(n,e)}var s,c,a={},d=new j("/",new j("/..")),p=I(d);function h(n,e){return y(n)&&(!function r(o,e,i){Array.isArray(e)?(e.forEach(function(n){w(n)?o.deps[n]=o.module.id:b(n)?e=n:y(n)&&(o.stub=o.stub||{},A(n,function(n,e){o.stub[e]=n}))}),b(e)||(e=null)):b(e)||w(e)||y(e)||(e=null);e&&(o.contents=o.contents||(y(e)?{}:e),y(e)&&g(o)&&A(e,function(n,e){if(".."===e)t=o.parent;else{var t=m(o.contents,e);t||((t=o.contents[e]=new j(o.module.id.replace(/\/*$/,"/")+e,o)).options=i)}r(t,n,i)}))}(d,n,e),b(t)&&t(p)),p}function v(n){this.id=n,this.children=[],this.childrenById={}}function m(n,e){return u(n,e)&&n[e]}function y(n){return null!==n&&"object"==typeof n}function b(n){return"function"==typeof n}function w(n){return"string"==typeof n}function x(n){return new Error("Cannot find module '"+n+"'")}function I(n){var e=n.module;function t(n){return e.require(n)}return b(r)&&(t=r(t,n.module)),t.extensions=B(n).slice(0),t.resolve=function(n){return e.resolve(n)},t}function j(n,e){var t=this;t.parent=e=e||null,t.module=new v(n),(a[n]=t).contents=null,t.deps={}}function k(n,e){var t=n.module;if(!u(t,"exports")){var r=n.contents;if(!r){if(n.stub)return n.stub;throw x(t.id)}if(e){var o=(t.parent=e).children;Array.isArray(o)&&o.push(t)}r(I(n),t.exports=n.stub||{},t,n.module.id,n.parent.module.id),t.loaded=!0}var i=t.runSetters||t.runModuleSetters;return b(i)&&i.call(t),t.exports}function g(n){return n&&y(n.contents)}function A(e,t,n){Object.keys(e).forEach(function(n){t.call(this,e[n],n)},n)}function B(n){return n.options&&n.options.extensions||e}function E(n,e,t){for(;n&&!g(n);)n=n.parent;if(!n||!e||"."===e)return n;if(".."===e)return n.parent;var r=m(n.contents,e);if(t&&(!r||g(r)))for(var o=0;o<t.length;++o){var i=m(n.contents,e+t[o]);if(i&&!g(i))return i}return r}function O(t,n,r){var o=n.split("/");return o.every(function(n,e){return t=e<o.length-1?E(t,n):E(t,n,r)}),t}function P(n,e){var t=e&&e.module;n&&t&&(n.childrenById[t.id]=t)}function q(n,e,t,r){t=t||n.module;var o=B(n);for(n="/"===e.charAt(0)?O(d,e,o):"."===e.charAt(0)?O(n,e,o):function(n,e,t){b(f)&&(e=f(e,n.module.id));if(w(e)){for(var r;n&&!r;n=n.parent)r=g(n)&&O(n,"node_modules/"+e,t);return r}}(n,e,o);g(n);){if((r=r||[]).indexOf(n)<0){r.push(n);var i,u=E(n,"package.json"),s=u&&k(u,t);if(s&&l.some(function(n){return w(i=s[n])})){var c=O(n,i,o)||q(n,i,t,r);if(c){n=c,P(t,u);continue}}}n=E(n,"index",o)}return n&&w(n.contents)&&(n=q(n,n.contents,t,r)),P(t,n),n}return h.fetch=function(n){throw new Error("fetch not implemented")},v.prototype.prefetch=function(t){var r=this,o=(m(a,r.id),s=s||Promise.resolve());function i(n){var e,t=m(a,n.id);(e=t)&&null===e.contents&&!t.pending&&(t.pending=!0,(c=c||{})[n.id]={module:t.module,deps:Object.keys(t.deps),options:t.options,stub:t.stub},A(t.deps,function(n,e){q(t,e)}),A(n.childrenById,i))}return s=new Promise(function(n){var e=r.resolve(t);A(r.childrenById,i),n(e)}).then(function(t){var n=c;return c=null,Promise.resolve(n&&h.fetch(n)).then(function(n){function e(){return h(n),t}return o.then(e,e)})})},(h.Module=v).prototype.resolve=function(n){var e=q(a[this.id],n);if(e)return e.module.id;var t=x(n);if(o&&b(o.resolve))return o.resolve(n,this.id,t);throw t},v.prototype.require=function(n){var e=q(a[this.id],n);if(e)return k(e,this);var t=x(n);if(b(o))return o(n,this.id,t);throw t},h},"object"==typeof exports&&(exports.makeInstaller=makeInstaller);
